<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConectaServ - Login Cliente</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Caminho correto do CSS -->
    <link rel="stylesheet" href="/static/img/style.css">
</head>
<body>

    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">ConectaServ</a>
            <img src="/static/img/logo.png" alt="logo ConectaServ" class="logo">
        </div>
    </nav>

    <div class="container mt-5" style="max-width: 450px;">
        <h3 class="text-center mb-4">Login do Cliente</h3>

        <!-- ÁREA DE MENSAGENS -->
        <div id="mensagem-login"></div>

        <form id="form-login" class="card p-4 shadow">

            <div class="mb-3">
                <label for="login-email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="login-email" required>
            </div>

            <div class="mb-3">
                <label for="login-senha" class="form-label">Senha</label>
                <input type="password" class="form-control" id="login-senha" required>
            </div>

            <button type="submit" class="btn btn-primary w-100">Entrar</button>

            <p class="mt-3 text-center">
                Não tem conta?
                <a href="cadastro_cliente.html">Cadastre-se aqui</a>
            </p>
        </form>
    </div>

    <footer class="rodape">
        <p>ConectaServ - Todos os direitos reservados 2025</p>
    </footer>

    <!-- Caminho correto do cliente.js -->
    <script src="/static/cliente.js"></script>

    <!-- SCRIPT DE MENSAGENS E INTEGRAÇÃO -->
    <script>
        const formLogin = document.getElementById("form-login");
        const msgLogin = document.getElementById("mensagem-login");

        formLogin.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("login-email").value.trim();
            const senha = document.getElementById("login-senha").value;

            try {
                const resposta = await fetch("/api/client/login", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ email, senha })
                });

                const data = await resposta.json();

                if (!resposta.ok) {
                    msgLogin.innerHTML = `
                        <div class="alert alert-danger">
                            Erro ao efetuar login: ${data.error || "Dados inválidos."}
                        </div>`;
                    return;
                }

                // salva token e ID do cliente
                localStorage.setItem("token_cliente", data.token);
                localStorage.setItem("cliente_id", data.cliente.id);

                msgLogin.innerHTML = `
                    <div class="alert alert-success">
                        Login realizado com sucesso! Redirecionando...
                    </div>`;

                setTimeout(() => {
                    window.location.href = "cliente.html";
                }, 1200);

            } catch (erro) {
                msgLogin.innerHTML = `
                    <div class="alert alert-danger">
                        Erro ao conectar ao servidor. Tente novamente.
                    </div>`;
            }
        });
    </script>

</body>
</html>
